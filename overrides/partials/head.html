{% block htmltitle %}
  <title>{% if page.meta and page.meta.title %}{{ page.meta.title }}{% elif page.title and not page.is_homepage %}{{ page.title | striptags }} - {{ config.site_name }}{% else %}{{ config.site_name }}{% endif %}</title>
{% endblock %}

<!-- Preconnect to critical external domains for faster resource loading -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://api.github.com">
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<link rel="preconnect" href="https://ka-f.fontawesome.com" crossorigin>
<link rel="preconnect" href="https://kit.fontawesome.com">

<!-- Meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

{% if page.meta and page.meta.description %}
  <meta name="description" content="{{ page.meta.description }}">
{% elif config.site_description %}
  <meta name="description" content="{{ config.site_description }}">
{% endif %}

{% if page.meta and page.meta.keywords %}
  <meta name="keywords" content="{{ page.meta.keywords }}">
{% endif %}

{% if page.canonical_url %}
  <link rel="canonical" href="{{ page.canonical_url }}">
{% endif %}

{% if page.meta and page.meta.author %}
  <meta name="author" content="{{ page.meta.author }}">
{% elif config.site_author %}
  <meta name="author" content="{{ config.site_author }}">
{% endif %}

<!-- Favicon -->
{% if config.theme.favicon %}
  <link rel="icon" href="{{ config.theme.favicon | url }}">
{% endif %}

<!-- Theme color -->
{% if config.theme.palette %}
  {% set palette = config.theme.palette %}
  {% if not palette is mapping %}
    {% set palette = palette | first %}
  {% endif %}
  {% set scheme  = palette.scheme  | d("default", true) %}
  {% set primary = palette.primary | d("indigo", true) %}
  {% set accent  = palette.accent  | d("indigo", true) %}
  <meta name="theme-color" content="{{ primary }}">
{% endif %}

<!-- Google Fonts with font-display swap for better performance -->
{% if config.theme.font != false %}
  {% set text = config.theme.font.text | d("Roboto", true) %}
  {% set code = config.theme.font.code | d("Roboto Mono", true) %}
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css?family={{ text | replace(' ', '+') }}:300,300i,400,400i,700,700i%7C{{ code | replace(' ', '+') }}&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family={{ text | replace(' ', '+') }}:300,300i,400,400i,700,700i%7C{{ code | replace(' ', '+') }}&display=swap">
  <style>
    body, input { font-family: "{{ text }}", -apple-system, BlinkMacSystemFont, Helvetica, Arial, sans-serif }
    code, kbd, pre { font-family: "{{ code }}", SFMono-Regular, Consolas, Menlo, monospace }
  </style>
{% endif %}

<!-- FontAwesome with font-display swap -->
<link rel="preload" as="style" href="https://ka-f.fontawesome.com/releases/v6.7.2/css/free.min.css">
<link rel="stylesheet" href="https://ka-f.fontawesome.com/releases/v6.7.2/css/free.min.css">
<style>
  /* Add font-display swap to FontAwesome fonts */
  @font-face {
    font-family: 'Font Awesome 6 Free';
    font-style: normal;
    font-weight: 400;
    font-display: swap;
  }
  @font-face {
    font-family: 'Font Awesome 6 Free';
    font-style: normal;
    font-weight: 900;
    font-display: swap;
  }
  @font-face {
    font-family: 'Font Awesome 6 Brands';
    font-style: normal;
    font-weight: 400;
    font-display: swap;
  }
</style>

<!-- Stylesheets -->
{% for path in config.extra_css %}
  <link rel="stylesheet" href="{{ path | url }}">
{% endfor %}

<!-- Analytics -->
{% if config.extra.analytics %}
  {% if config.extra.analytics.provider == "google" %}
    <!-- Defer Google Analytics for better performance -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ config.extra.analytics.property }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ config.extra.analytics.property }}', {
        'anonymize_ip': true
      });
    </script>
  {% endif %}
{% endif %}

<!-- Custom head from page metadata -->
{% if page.meta and page.meta.head %}
  {{ page.meta.head }}
{% endif %}

